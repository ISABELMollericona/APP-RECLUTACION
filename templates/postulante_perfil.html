{% extends 'base.html' %}
{% block content %}
  <div class="row">
    <div class="col-md-8">
      <div class="card shadow-sm mb-4">
        <div class="card-header bg-primary text-white">
          <h3 class="mb-0">Perfil Profesional</h3>
        </div>
        <div class="card-body">
          <!-- Informaci칩n Personal -->
          <div class="mb-4">
            <h5>Informaci칩n Personal</h5>
            <div class="row">
              <div class="col-md-6">
                <p><strong>Nombre:</strong><br>{{ postulante.nombre }}</p>
              </div>
              <div class="col-md-6">
                <p><strong>Email:</strong><br>{{ postulante.email }}</p>
              </div>
            </div>
          </div>

          <!-- Experiencia -->
          <div class="mb-4">
            <h5>Experiencia Profesional</h5>
            <p><strong>A침os de experiencia:</strong> {{ postulante.anos_experiencia }} a침os</p>
          </div>

          <!-- Habilidades -->
          <div class="mb-4">
            <h5>Habilidades</h5>
            {% if postulante.habilidades and postulante.habilidades != '[]' %}
              <div class="d-flex flex-wrap gap-2">
                {% for skill in postulante.habilidades | from_json %}
                  <span class="badge bg-info text-dark">{{ skill }}</span>
                {% endfor %}
              </div>
            {% else %}
              <p class="text-muted">No has a침adido habilidades a칰n.</p>
            {% endif %}
          </div>

          <!-- CV -->
          <div class="mb-4">
            <h5>Curr칤culum Vitae</h5>
            {% if postulante.cv_path %}
              <a href="/{{ postulante.cv_path }}" target="_blank" class="btn btn-info btn-sm">
                游늯 Descargar CV
              </a>
            {% else %}
              <p class="text-muted">No has cargado un CV a칰n.</p>
            {% endif %}
          </div>
        </div>
      </div>

      <!-- Mis Postulaciones -->
      <div class="card shadow-sm">
        <div class="card-header bg-secondary text-white">
          <h5 class="mb-0">Mis Postulaciones</h5>
        </div>
        <div class="card-body">
          {% if postulaciones %}
            <div class="table-responsive">
              <table class="table table-hover">
                <thead>
                  <tr>
                    <th>Vacante</th>
                    <th>Departamento</th>
                    <th>Fecha</th>
                    <th>Estado</th>
                    <th>Score</th>
                    <th>Acciones</th>
                  </tr>
                </thead>
                <tbody>
                  {% for post in postulaciones %}
                    <tr>
                      <td><strong>{{ post.titulo }}</strong></td>
                      <td>{{ post.departamento }}</td>
                      <td>{{ post.fecha_postulacion | strftime('%d/%m/%Y') }}</td>
                      <td>
                        {% if post.estado == 'en_revision' %}
                          <span class="badge bg-warning text-dark">En revisi칩n</span>
                        {% elif post.estado == 'aceptado' %}
                          <span class="badge bg-success">Aceptado</span>
                        {% elif post.estado == 'rechazado' %}
                          <span class="badge bg-danger">Rechazado</span>
                        {% else %}
                          <span class="badge bg-secondary">{{ post.estado }}</span>
                        {% endif %}
                      </td>
                      <td>{{ post.score | default('--') }}</td>
                      <td>
                        <a href="/postulacion/{{ post.postulacion_id }}/timeline" class="btn btn-sm btn-outline-primary">
                          Ver Timeline
                        </a>
                      </td>
                    </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          {% else %}
            <p class="text-muted">A칰n no has realizado postulaciones.</p>
          {% endif %}
        </div>
      </div>
    </div>

    <!-- Sidebar -->
    <div class="col-md-4">
      <div class="card shadow-sm">
        <div class="card-body text-center">
          <h5 class="card-title">Acciones R치pidas</h5>
          <div class="d-grid gap-2">
            <a href="/postulante/editar/{{ postulante.id }}" class="btn btn-primary">
              九勇 Editar Perfil
            </a>
            <a href="/" class="btn btn-outline-primary">
              游댌 Explorar Vacantes
            </a>
            <a href="/logout" class="btn btn-outline-danger">
              游뛁 Cerrar Sesi칩n
            </a>
          </div>
        </div>
      </div>

      <!-- Estad칤sticas -->
      <div class="card shadow-sm mt-3">
        <div class="card-body">
          <h5 class="card-title">Mi Actividad</h5>
          <div class="mb-2">
            <small class="text-muted">Total de postulaciones:</small>
            <p class="h5">{{ postulaciones | length }}</p>
          </div>
          <div class="mb-2">
            <small class="text-muted">Aceptadas:</small>
            <p class="h5 text-success">{{ postulaciones | selectattr('estado', 'equalto', 'aceptado') | list | length }}</p>
          </div>
          <div class="mb-2">
            <small class="text-muted">Rechazadas:</small>
            <p class="h5 text-danger">{{ postulaciones | selectattr('estado', 'equalto', 'rechazado') | list | length }}</p>
          </div>
        </div>
      </div>
    </div>
  </div>
{% endblock %}
